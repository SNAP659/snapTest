function List(t){this.contents=t||[],this.first=null,this.rest=null,this.isLinked=!1,this.lastChanged=Date.now()}function ListWatcherMorph(t,e){this.init(t,e)}modules.lists="2014-November-20";var List,ListWatcherMorph;List.prototype.toString=function(){return"a List ["+this.asArray()+"]"},List.prototype.changed=function(){this.lastChanged=Date.now()},List.prototype.cons=function(t,e){var s=new List;if(!(e instanceof List||isNil(e)))throw new Error("cdr isn't a list: "+e);return s.first=isNil(t)?null:t,s.rest=e||null,s.isLinked=!0,s},List.prototype.cdr=function(){var t,e;if(this.isLinked)return this.rest||new List;if(this.contents.length<2)return new List;for(t=new List,e=this.contents.length;e>1;e-=1)t=this.cons(this.at(e),t);return t},List.prototype.add=function(t,e){var s=e||this.length()+1,i=0===t?0:t===!1?!1:t||null;this.becomeArray(),this.contents.splice(s-1,0,i),this.changed()},List.prototype.put=function(t,e){var s=0===t?0:t===!1?!1:t||null;this.becomeArray(),this.contents[e-1]=s,this.changed()},List.prototype.remove=function(t){this.becomeArray(),this.contents.splice(t-1,1),this.changed()},List.prototype.clear=function(){this.contents=[],this.first=null,this.rest=null,this.isLinked=!1,this.changed()},List.prototype.length=function(){if(this.isLinked){for(var t=this,e=0;t&&t.isLinked;)e+=1,t=t.rest;return e+(t?t.contents.length:0)}return this.contents.length},List.prototype.at=function(t){for(var e,s=+t,i=this;i.isLinked;){if(!(s>1))return i.first;i=i.rest,s-=1}return e=i.contents[s-1],isNil(e)?"":e},List.prototype.contains=function(t){for(var e=this;e.isLinked;){if(snapEquals(e.first,t))return!0;e=e.rest}return e.contents.some(function(e){return snapEquals(e,t)})},List.prototype.asArray=function(){return this.becomeArray(),this.contents},List.prototype.asText=function(){for(var t,e,s,i="",n=this;n.isLinked;)e=n.first,e instanceof List?i=i.concat(e.asText()):(e=isNil(e)?"":e.toString(),i=i.concat(e)),n=n.rest;for(t=n.length(),s=1;t>=s;s+=1)e=n.at(s),e instanceof List?i=i.concat(e.asText()):(e=isNil(e)?"":e.toString(),i=i.concat(e));return i},List.prototype.becomeArray=function(){if(this.isLinked){var t,e=this;for(this.contents=[];e&&e.isLinked;)this.contents.push(e.first),e=e.rest;if(e)for(t=1;t<=e.contents.length;t+=1)this.contents.push(e.at(t));this.isLinked=!1,this.first=null,this.rest=null}},List.prototype.becomeLinked=function(){var t,e,s=this;if(!this.isLinked){for(e=this.length(),t=0;e>t;t+=1)s.first=this.contents[t],s.rest=new List,s.isLinked=!0,s=s.rest;this.contents=[],this.isLinked=!0}},List.prototype.equalTo=function(t){var e,s,i,n=this,o=t;if(!(t instanceof List))return!1;for(;n.isLinked&&o.isLinked;){if(!snapEquals(n.first,o.first))return!1;n=n.rest,o=o.rest}for(o.isLinked&&(e=o,o=n,n=e),s=0;n.isLinked;){if(!snapEquals(n.first,o.contents[s]))return!1;n=n.rest,s+=1}if(e=0,n.contents.length!==o.contents.length-s)return!1;for(i=n.contents.length;i>0;){if(i-=1,!snapEquals(n.contents[e],o.contents[s]))return!1;e+=1,s+=1}return!0},ListWatcherMorph.prototype=new BoxMorph,ListWatcherMorph.prototype.constructor=ListWatcherMorph,ListWatcherMorph.uber=BoxMorph.prototype,ListWatcherMorph.prototype.cellColor=SpriteMorph.prototype.blockColor.lists,ListWatcherMorph.prototype.init=function(t,e){var s=this;this.list=t||new List,this.start=1,this.range=100,this.lastUpdated=Date.now(),this.lastCell=null,this.parentCell=e||null,this.label=new StringMorph(localize("length: ")+this.list.length(),SyntaxElementMorph.prototype.fontSize,null,!1,!1,!1,MorphicPreferences.isFlat?new Point:new Point(1,1),new Color(255,255,255)),this.label.mouseClickLeft=function(){s.startIndexMenu()},this.frame=new ScrollFrameMorph(null,10),this.frame.alpha=0,this.frame.acceptsDrops=!1,this.frame.contents.acceptsDrops=!1,this.handle=new HandleMorph(this,80,70,3,3),this.handle.setExtent(new Point(13,13)),this.arrow=new ArrowMorph("down",SyntaxElementMorph.prototype.fontSize),this.arrow.mouseClickLeft=function(){s.startIndexMenu()},this.arrow.setRight(this.handle.right()),this.arrow.setBottom(this.handle.top()),this.handle.add(this.arrow),this.plusButton=new PushButtonMorph(this.list,"add","+"),this.plusButton.padding=0,this.plusButton.edge=0,this.plusButton.outlineColor=this.color,this.plusButton.drawNew(),this.plusButton.fixLayout(),ListWatcherMorph.uber.init.call(this,SyntaxElementMorph.prototype.rounding,1.000001,new Color(120,120,120)),this.color=new Color(220,220,220),this.isDraggable=!0,this.setExtent(new Point(80,70).multiplyBy(SyntaxElementMorph.prototype.scale)),this.add(this.label),this.add(this.frame),this.add(this.plusButton),this.add(this.handle),this.handle.drawNew(),this.update(),this.fixLayout()},ListWatcherMorph.prototype.update=function(t){var e,s,i,n,o,r,h,a,l,c,p=1e3;if(this.frame.contents.children.forEach(function(t){t instanceof CellMorph&&t.contentsMorph instanceof ListWatcherMorph&&t.contentsMorph.update()}),this.lastUpdated===this.list.lastChanged&&!t)return null;for(this.updateLength(!0),this.start=Math.max(Math.min(this.start,Math.floor((this.list.length()-1)/this.range)*this.range+1),1),l=Math.min(this.start+this.range-1,this.list.length()),i=Math.min(3*(l-this.start+1),this.frame.contents.children.length),e=0;i>e;e+=3)s=this.start+e/3,o=this.frame.contents.children[e],h=this.frame.contents.children[e+1],a=this.frame.contents.children[e+2],r=this.list.at(s),o.contents!==r&&(o.contents=r,o.drawNew(),this.lastCell&&o.setLeft(this.lastCell.left())),this.lastCell=o,h.text!==s.toString()&&(h.text=s.toString(),h.drawNew()),a.action=s;for(n=3*(l-this.start+1);this.frame.contents.children.length>n;)this.frame.contents.children[n].destroy();if(i=n,e=this.frame.contents.children.length,c=Date.now(),i>e+1)for(e;i>e;e+=3){if(Date.now()-c>p)return this.fixLayout(),this.frame.contents.adjustBounds(),this.frame.contents.setLeft(this.frame.left()),null;s=this.start+e/3,h=new StringMorph(s.toString(),SyntaxElementMorph.prototype.fontSize,null,!1,!1,!1,MorphicPreferences.isFlat?new Point:new Point(1,1),new Color(255,255,255)),o=new CellMorph(this.list.at(s),this.cellColor,s,this.parentCell),a=new PushButtonMorph(this.list.remove,s,"-",this.list),a.padding=1,a.edge=0,a.corner=1,a.outlineColor=this.color.darker(),a.drawNew(),a.fixLayout(),this.frame.contents.add(o),this.lastCell?o.setPosition(this.lastCell.bottomLeft()):o.setTop(this.frame.contents.top()),this.lastCell=o,h.setCenter(o.center()),h.setRight(o.left()-2),this.frame.contents.add(h),this.frame.contents.add(a)}this.lastCell=null,this.fixLayout(),this.frame.contents.adjustBounds(),this.frame.contents.setLeft(this.frame.left()),this.updateLength(),this.lastUpdated=this.list.lastChanged},ListWatcherMorph.prototype.updateLength=function(t){this.label.text=localize("length: ")+this.list.length(),t?this.label.color=new Color(0,0,100):this.label.color=new Color(0,0,0),this.label.drawNew(),this.label.setCenter(this.center()),this.label.setBottom(this.bottom()-3)},ListWatcherMorph.prototype.startIndexMenu=function(){var t,e,s=this,i=Math.ceil(this.list.length()/this.range),n=new MenuMorph(function(t){s.setStartIndex(t)},null,s);for(n.addItem("1...",1),t=1;i>t;t+=1)e=100*t+1,n.addItem(e+"...",e);n.popUpAtHand(this.world())},ListWatcherMorph.prototype.setStartIndex=function(t){this.start=t,this.list.changed()},ListWatcherMorph.prototype.fixLayout=function(){Morph.prototype.trackChanges=!1,this.frame&&(this.arrangeCells(),this.frame.silentSetPosition(this.position().add(3)),this.frame.bounds.corner=this.bounds.corner.subtract(new Point(3,17)),this.frame.drawNew(),this.frame.contents.adjustBounds()),this.label.setCenter(this.center()),this.label.setBottom(this.bottom()-3),this.plusButton.setLeft(this.left()+3),this.plusButton.setBottom(this.bottom()-3),Morph.prototype.trackChanges=!0,this.changed(),this.parent&&this.parent.fixLayout&&this.parent.fixLayout()},ListWatcherMorph.prototype.arrangeCells=function(){var t,e,s,i,n,o=this.frame.contents.children.length;for(t=0;o>t;t+=3)e=this.frame.contents.children[t],s=this.frame.contents.children[t+1],i=this.frame.contents.children[t+2],n&&e.setTop(n.bottom()),s&&(s.setTop(e.center().y-s.height()/2),s.setRight(e.left()-2)),i&&(i.setCenter(e.center()),i.setLeft(e.right()+2)),n=e;this.frame.contents.adjustBounds()},ListWatcherMorph.prototype.show=function(){ListWatcherMorph.uber.show.call(this),this.frame.contents.adjustBounds()},ListWatcherMorph.prototype.drawNew=function(){WatcherMorph.prototype.drawNew.call(this),this.fixLayout()};