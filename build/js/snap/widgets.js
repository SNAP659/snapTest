function PushButtonMorph(t,e,i,o,h,n){this.init(t,e,i,o,h,n)}function ToggleButtonMorph(t,e,i,o,h,n,r,s,l,a,d){this.init(t,e,i,o,h,n,r,s,l,a,d)}function TabMorph(t,e,i,o,h,n,r){this.init(t,e,i,o,h,n,r)}function ToggleMorph(t,e,i,o,h,n,r,s,l,a){this.init(t,e,i,o,h,n,r,s,l,a)}function ToggleElementMorph(t,e,i,o,h,n,r,s){this.init(t,e,i,o,h,n,r,s)}function DialogBoxMorph(t,e,i){this.init(t,e,i)}function AlignmentMorph(t,e){this.init(t,e)}function InputFieldMorph(t,e,i,o,h,n){this.init(t,e,i,o,h,n)}modules.widgets="2014-February-13";var PushButtonMorph,ToggleButtonMorph,TabMorph,ToggleMorph,ToggleElementMorph,DialogBoxMorph,AlignmentMorph,InputFieldMorph;PushButtonMorph.prototype=new TriggerMorph,PushButtonMorph.prototype.constructor=PushButtonMorph,PushButtonMorph.uber=TriggerMorph.prototype,PushButtonMorph.prototype.fontSize=18,PushButtonMorph.prototype.fontStyle="微软雅黑",PushButtonMorph.prototype.labelColor=new Color(0,0,0),PushButtonMorph.prototype.labelShadowColor=new Color(255,255,255),PushButtonMorph.prototype.labelShadowOffset=new Point(0,0),PushButtonMorph.prototype.color=new Color(220,220,220),PushButtonMorph.prototype.pressColor=new Color(115,180,240),PushButtonMorph.prototype.highlightColor=PushButtonMorph.prototype.pressColor.lighter(50),PushButtonMorph.prototype.outlineColor=new Color(30,30,30),PushButtonMorph.prototype.outlineGradient=!1,PushButtonMorph.prototype.contrast=60,PushButtonMorph.prototype.edge=0,PushButtonMorph.prototype.corner=0,PushButtonMorph.prototype.outline=0,PushButtonMorph.prototype.padding=0,PushButtonMorph.prototype.init=function(t,e,i,o,h,n){this.is3D=!1,this.target=t||null,this.action=e||null,this.environment=o||null,this.labelString=i||null,this.label=null,this.labelMinExtent=new Point(0,0),this.hint=h||null,this.template=n||null,TriggerMorph.uber.init.call(this),this.color=PushButtonMorph.prototype.color,this.drawNew(),this.fixLayout()},PushButtonMorph.prototype.fixLayout=function(){if(null!==this.label){var t=2*this.padding+2*this.outline+2*this.edge;this.setExtent(new Point(Math.max(this.label.width(),this.labelMinExtent.x)+t,Math.max(this.label instanceof StringMorph?this.label.rawHeight():this.label.height(),this.labelMinExtent.y)+t)),this.label.setCenter(this.center())}},PushButtonMorph.prototype.mouseDownLeft=function(){PushButtonMorph.uber.mouseDownLeft.call(this),this.label&&this.label.setCenter(this.center().add(1))},PushButtonMorph.prototype.mouseClickLeft=function(){PushButtonMorph.uber.mouseClickLeft.call(this),this.label&&this.label.setCenter(this.center())},PushButtonMorph.prototype.mouseLeave=function(){PushButtonMorph.uber.mouseLeave.call(this),this.label&&this.label.setCenter(this.center())},PushButtonMorph.prototype.outlinePath=BoxMorph.prototype.outlinePath,PushButtonMorph.prototype.drawOutline=function(t){var e,i=MorphicPreferences.isFlat&&!this.is3D;return!this.outline||i?null:(e=this.outlineColor.toString(),t.fillStyle=e,t.beginPath(),this.outlinePath(t,this.corner,0),t.closePath(),void t.fill())},PushButtonMorph.prototype.drawBackground=function(t,e){t.fillStyle=e.toString(),t.beginPath(),this.outlinePath(t,Math.max(this.corner-this.outline,0),this.outline),t.closePath(),t.fill(),t.lineWidth=this.outline},PushButtonMorph.prototype.drawEdges=function(t,e,i,o){if(!MorphicPreferences.isFlat||this.is3D){var h,n=Math.max(this.corner,this.outline+this.edge),r=this.width(),s=this.height();h=t.createLinearGradient(0,this.outline,0,this.outline+this.edge),h.addColorStop(0,i.toString()),h.addColorStop(1,e.toString()),t.strokeStyle=h,t.lineCap="round",t.lineWidth=this.edge,t.beginPath(),t.moveTo(n,this.outline+this.edge/2),t.lineTo(r-n,this.outline+this.edge/2),t.stroke(),h=t.createRadialGradient(this.corner,this.corner,Math.max(this.corner-this.outline-this.edge,0),this.corner,this.corner,Math.max(this.corner-this.outline,0)),h.addColorStop(1,i.toString()),h.addColorStop(0,e.toString()),t.strokeStyle=h,t.lineCap="round",t.lineWidth=this.edge,t.beginPath(),t.arc(this.corner,this.corner,Math.max(this.corner-this.outline-this.edge/2,0),radians(180),radians(270),!1),t.stroke(),h=t.createLinearGradient(this.outline,0,this.outline+this.edge,0),h.addColorStop(0,i.toString()),h.addColorStop(1,e.toString()),t.strokeStyle=h,t.lineCap="round",t.lineWidth=this.edge,t.beginPath(),t.moveTo(this.outline+this.edge/2,n),t.lineTo(this.outline+this.edge/2,s-n),t.stroke(),h=t.createLinearGradient(0,s-this.outline,0,s-this.outline-this.edge),h.addColorStop(0,o.toString()),h.addColorStop(1,e.toString()),t.strokeStyle=h,t.lineCap="round",t.lineWidth=this.edge,t.beginPath(),t.moveTo(n,s-this.outline-this.edge/2),t.lineTo(r-n,s-this.outline-this.edge/2),t.stroke(),h=t.createRadialGradient(r-this.corner,s-this.corner,Math.max(this.corner-this.outline-this.edge,0),r-this.corner,s-this.corner,Math.max(this.corner-this.outline,0)),h.addColorStop(1,o.toString()),h.addColorStop(0,e.toString()),t.strokeStyle=h,t.lineCap="round",t.lineWidth=this.edge,t.beginPath(),t.arc(r-this.corner,s-this.corner,Math.max(this.corner-this.outline-this.edge/2,0),radians(0),radians(90),!1),t.stroke(),h=t.createLinearGradient(r-this.outline,0,r-this.outline-this.edge,0),h.addColorStop(0,o.toString()),h.addColorStop(1,e.toString()),t.strokeStyle=h,t.lineCap="round",t.lineWidth=this.edge,t.beginPath(),t.moveTo(r-this.outline-this.edge/2,n),t.lineTo(r-this.outline-this.edge/2,s-n),t.stroke()}},PushButtonMorph.prototype.createBackgrounds=function(){var t,e=this.extent();return this.template?(this.image=this.template.image,this.normalImage=this.template.normalImage,this.highlightImage=this.template.highlightImage,this.pressImage=this.template.pressImage,null):(this.normalImage=newCanvas(e),t=this.normalImage.getContext("2d"),this.drawOutline(t),this.drawBackground(t,this.color),this.cachedTexture?this.drawCachedTexture(null,null,"normal"):this.texture&&this.drawTexture(this.texture,null,null,"normal"),this.highlightImage=newCanvas(e),t=this.highlightImage.getContext("2d"),this.drawOutline(t),this.drawBackground(t,this.highlightColor),this.cachedHighlightTexture?this.drawCachedTexture(null,null,"highlight"):this.highlightTexture&&this.drawTexture(this.highlightTexture,null,null,"highlight"),this.pressImage=newCanvas(e),t=this.pressImage.getContext("2d"),this.drawOutline(t),this.drawBackground(t,this.pressColor),this.cachedPressTexture?this.drawCachedTexture(null,null,"press"):this.pressTexture&&this.drawTexture(this.pressTexture,null,null,"press"),void(this.image=this.normalImage))},PushButtonMorph.prototype.createLabel=function(){var t=0;null!==this.label&&this.label.destroy(),this.labelString instanceof SymbolMorph?(this.label=this.labelString.fullCopy(),t&&(this.label.shadowOffset=this.labelShadowOffset,this.label.shadowColor=this.labelShadowColor),this.label.color=this.labelColor,this.label.drawNew()):this.label=new StringMorph(localize(this.labelString),this.fontSize,this.fontStyle,!1,!1,!1,t?this.labelShadowOffset:null,this.labelShadowColor,this.labelColor),this.add(this.label)},ToggleButtonMorph.prototype=new PushButtonMorph,ToggleButtonMorph.prototype.constructor=ToggleButtonMorph,ToggleButtonMorph.uber=PushButtonMorph.prototype,ToggleButtonMorph.prototype.contrast=30,ToggleButtonMorph.prototype.init=function(t,e,i,o,h,n,r,s,l,a,d){this.state=!1,this.query=h||function(){return!0},this.minWidth=l||null,this.hasPreview=a||!1,this.isPicture=d||!1,this.trueStateLabel=null,ToggleButtonMorph.uber.init.call(this,e,i,o,n,r,s),t&&(this.color=t[0],this.highlightColor=t[1],this.pressColor=t[2]),this.refresh(),this.drawNew()},ToggleButtonMorph.prototype.mouseEnter=function(){this.state||(this.image=this.highlightImage,this.changed()),this.hint&&this.bubbleHelp(this.hint)},ToggleButtonMorph.prototype.mouseLeave=function(){this.state||(this.image=this.normalImage,this.changed()),this.hint&&this.world().hand.destroyTemporaries()},ToggleButtonMorph.prototype.mouseDownLeft=function(){this.state||(this.image=this.pressImage,this.changed())},ToggleButtonMorph.prototype.mouseClickLeft=function(){this.state||(this.image=this.highlightImage,this.changed()),this.trigger()},ToggleButtonMorph.prototype.trigger=function(){ToggleButtonMorph.uber.trigger.call(this),this.refresh()},ToggleButtonMorph.prototype.refresh=function(){"function"==typeof this.query?this.state=this.query.call(this.target):this.state=this.target[this.query](),this.state?(this.image=this.pressImage,this.trueStateLabel&&(this.label.hide(),this.trueStateLabel.show()),this.deleteButton&&this.deleteButton.show(),this.editorButton&&this.editorButton.show()):(this.image=this.normalImage,this.trueStateLabel&&(this.label.show(),this.trueStateLabel.hide()),this.deleteButton&&this.deleteButton.hide(),this.editorButton&&this.editorButton.hide()),this.changed()},ToggleButtonMorph.prototype.fixLayout=function(){if(null!==this.label){var t=Math.max(this.label.width(),this.labelMinExtent.x),e=2*this.padding+2*this.outline+2*this.edge;this.setExtent(new Point(this.minWidth?Math.max(this.minWidth,t)+e:t+e,Math.max(this.label instanceof StringMorph?this.label.rawHeight():this.label.height(),this.labelMinExtent.y)+e)),this.label.setCenter(this.center()),this.trueStateLabel&&this.trueStateLabel.setCenter(this.center()),this.minWidth&&this.label.setCenter(this.center())}},ToggleButtonMorph.prototype.createBackgrounds=function(){var t,e=this.extent();return this.template?(this.image=this.template.image,this.normalImage=this.template.normalImage,this.highlightImage=this.template.highlightImage,this.pressImage=this.template.pressImage,null):(this.normalImage=newCanvas(e),t=this.normalImage.getContext("2d"),this.drawOutline(t),this.drawBackground(t,this.color),this.drawEdges(t,this.color,this.color.lighter(this.contrast),this.color.darker(this.contrast)),this.cachedTexture?this.drawCachedTexture(null,null,"normal"):this.texture&&this.drawTexture(this.texture,null,null,"normal"),this.highlightImage=newCanvas(e),t=this.highlightImage.getContext("2d"),this.drawOutline(t),this.drawBackground(t,this.highlightColor),this.drawEdges(t,this.highlightColor,this.highlightColor.lighter(this.contrast),this.highlightColor.darker(this.contrast)),this.cachedHighlightTexture?this.drawCachedTexture(null,null,"highlight"):this.highlightTexture&&this.drawTexture(this.highlightTexture,null,null,"highlight"),this.pressImage=newCanvas(e),t=this.pressImage.getContext("2d"),this.drawOutline(t),this.drawBackground(t,this.pressColor),this.drawEdges(t,this.pressColor,this.pressColor.lighter(40),this.pressColor.darker(40)),this.cachedPressTexture?this.drawCachedTexture(null,null,"press"):this.pressTexture&&this.drawTexture(this.pressTexture,null,null,"press"),void(this.image=this.normalImage))},ToggleButtonMorph.prototype.drawEdges=function(t,e,i,o){if(ToggleButtonMorph.uber.drawEdges.call(this,t,e,i,o),this.hasPreview){if(MorphicPreferences.isFlat&&!this.is3D)return t.fillStyle=this.pressColor.toString(),void t.fillRect(this.outline,this.outline,this.corner,this.height()-2*this.outline);t.fillStyle=this.pressColor.toString(),t.beginPath(),this.previewPath(t,Math.max(this.corner-this.outline,0),this.outline-1),t.closePath(),t.fillRect(this.outline,this.outline,15,this.height()-2*this.outline),t.fill()}},ToggleButtonMorph.prototype.previewPath=function(t,e,i){var o=e+i,h=this.height();t.arc(o,o,e,radians(-180),radians(-90),!1),t.arc(o,h-o,e,radians(90),radians(180),!1)},ToggleButtonMorph.prototype.createLabel=function(){var t=!MorphicPreferences.isFlat||this.is3D,e=new Point;null!==this.label&&this.label.destroy(),null!==this.trueStateLabel&&this.trueStateLabel.destroy(),this.labelString instanceof Array&&2===this.labelString.length?this.labelString[0]instanceof SymbolMorph?(this.label=this.labelString[0].fullCopy(),this.trueStateLabel=this.labelString[1].fullCopy(),this.isPicture||(this.label.shadowOffset=t?this.labelShadowOffset:e,this.label.shadowColor=this.labelShadowColor,this.label.color=this.labelColor,this.label.drawNew(),this.trueStateLabel.shadowOffset=t?this.labelShadowOffset:e,this.trueStateLabel.shadowColor=this.labelShadowColor,this.trueStateLabel.color=this.labelColor,this.trueStateLabel.drawNew())):this.labelString[0]instanceof Morph?(this.label=this.labelString[0].fullCopy(),this.trueStateLabel=this.labelString[1].fullCopy()):(this.label=new StringMorph(localize(this.labelString[0]),this.fontSize,this.fontStyle,!0,!1,!1,t?this.labelShadowOffset:null,this.labelShadowColor,this.labelColor),this.trueStateLabel=new StringMorph(localize(this.labelString[1]),this.fontSize,this.fontStyle,!0,!1,!1,t?this.labelShadowOffset:null,this.labelShadowColor,this.labelColor)):this.labelString instanceof SymbolMorph?(this.label=this.labelString.fullCopy(),this.isPicture||(this.label.shadowOffset=t?this.labelShadowOffset:e,this.label.shadowColor=this.labelShadowColor,this.label.color=this.labelColor,this.label.drawNew())):this.labelString instanceof Morph?this.label=this.labelString.fullCopy():this.label=new StringMorph(localize(this.labelString),this.fontSize,this.fontStyle,!0,!1,!1,t?this.labelShadowOffset:e,this.labelShadowColor,this.labelColor),this.add(this.label),this.trueStateLabel&&this.add(this.trueStateLabel)},ToggleButtonMorph.prototype.hide=function(){this.isVisible=!1,this.changed()},ToggleButtonMorph.prototype.show=function(){this.isVisible=!0,this.changed()},TabMorph.prototype=new ToggleButtonMorph,TabMorph.prototype.constructor=TabMorph,TabMorph.uber=ToggleButtonMorph.prototype,TabMorph.prototype.fixLayout=function(){null!==this.label&&(this.setExtent(new Point(this.label.width()+6*this.padding+3*this.corner,this.label.height()+4*this.padding)),this.label.setCenter(this.center()))},TabMorph.prototype.refresh=function(){this.state&&this.parent&&this.parent.add(this),TabMorph.uber.refresh.call(this)},TabMorph.prototype.drawBackground=function(t,e){var i=this.width(),o=this.height(),h=this.corner;t.fillStyle=e.toString(),t.beginPath(),t.moveTo(0,o),t.bezierCurveTo(h,o,h,0,2*h,0),t.lineTo(i-2*h,0),t.bezierCurveTo(i-h,0,i-h,o,i,o),t.closePath(),t.fill()},TabMorph.prototype.drawOutline=function(){nop()},TabMorph.prototype.drawEdges=function(t,e,i,o){if(!MorphicPreferences.isFlat||this.is3D){var h,n=this.width(),r=this.height(),s=this.corner,l=this.edge,a=l/2;nop(e),h=t.createLinearGradient(0,0,n,0),h.addColorStop(0,i.toString()),h.addColorStop(1,o.toString()),t.strokeStyle=h,t.lineCap="round",t.lineWidth=l,t.beginPath(),t.moveTo(0,r+a),t.bezierCurveTo(s,r,s,0,2*s,a),t.lineTo(n-2*s,a),t.bezierCurveTo(n-s,0,n-s,r,n,r+a),t.stroke()}},ToggleMorph.prototype=new PushButtonMorph,ToggleMorph.prototype.constructor=ToggleMorph,ToggleMorph.uber=PushButtonMorph.prototype,ToggleMorph.prototype.init=function(t,e,i,o,h,n,r,s,l,a){this.padding=1,this.outline=1,t=t||"checkbox",this.corner="checkbox"===t?0:fontHeight(this.fontSize)/2+this.outline+this.padding,this.state=!1,this.query=h||function(){return!0},this.tick=null,this.captionString=o||null,this.labelAlignment="right",this.element=l||null,this.builder=a||null,this.toggleElement=null,ToggleMorph.uber.init.call(this,e,i,"checkbox"===t?"√":"●",n,r,s),this.refresh(),this.drawNew()},ToggleMorph.prototype.fixLayout=function(){var t,e=2*this.padding+2*this.outline;null!==this.tick&&(this.silentSetHeight(this.tick.rawHeight()+e),this.silentSetWidth(this.tick.width()+e),this.setExtent(new Point(Math.max(this.width(),this.height()),Math.max(this.width(),this.height()))),this.tick.setCenter(this.center())),this.state?this.tick.show():this.tick.hide(),this.toggleElement&&"right"===this.labelAlignment&&(t=this.top()+(this.height()-this.toggleElement.height())/2,this.toggleElement.setPosition(new Point(this.right()+e,t))),null!==this.label&&(t=this.top()+(this.height()-this.label.height())/2,"right"===this.labelAlignment?this.label.setPosition(new Point(this.toggleElement?this.toggleElement instanceof ToggleElementMorph?this.toggleElement.right():this.toggleElement.right()+e:this.right()+e,t)):this.label.setPosition(new Point(this.left()-this.label.width()-e,t)))},ToggleMorph.prototype.createLabel=function(){var t=!MorphicPreferences.isFlat||this.is3D;null===this.label&&this.captionString&&(this.label=new TextMorph(localize(this.captionString),this.fontSize,this.fontStyle,!0),this.add(this.label)),null===this.tick&&(this.tick=new StringMorph(localize(this.labelString),this.fontSize,this.fontStyle,!0,!1,!1,t?new Point(1,1):null,new Color(240,240,240)),this.add(this.tick)),null===this.toggleElement&&this.element&&(this.element instanceof Morph?this.toggleElement=new ToggleElementMorph(this.target,this.action,this.element,this.query,this.environment,this.hint,this.builder):this.element instanceof HTMLCanvasElement&&(this.toggleElement=new Morph,this.toggleElement.silentSetExtent(new Point(this.element.width,this.element.height)),this.toggleElement.image=this.element),this.add(this.toggleElement))},ToggleMorph.prototype.trigger=function(){ToggleMorph.uber.trigger.call(this),this.refresh()},ToggleMorph.prototype.refresh=function(){"function"==typeof this.query?this.state=this.query.call(this.target):this.state=this.target[this.query](),this.state?this.tick.show():this.tick.hide(),this.toggleElement&&this.toggleElement.refresh&&this.toggleElement.refresh()},ToggleMorph.prototype.mouseDownLeft=function(){PushButtonMorph.uber.mouseDownLeft.call(this),this.tick&&this.tick.setCenter(this.center().add(1))},ToggleMorph.prototype.mouseClickLeft=function(){PushButtonMorph.uber.mouseClickLeft.call(this),this.tick&&this.tick.setCenter(this.center())},ToggleMorph.prototype.mouseLeave=function(){PushButtonMorph.uber.mouseLeave.call(this),this.tick&&this.tick.setCenter(this.center())},ToggleMorph.prototype.hide=ToggleButtonMorph.prototype.hide,ToggleMorph.prototype.show=ToggleButtonMorph.prototype.show,ToggleElementMorph.prototype=new TriggerMorph,ToggleElementMorph.prototype.constructor=ToggleElementMorph,ToggleElementMorph.uber=TriggerMorph.prototype,ToggleElementMorph.prototype.contrast=50,ToggleElementMorph.prototype.shadowOffset=new Point(2,2),ToggleElementMorph.prototype.shadowAlpha=.6,ToggleElementMorph.prototype.fontSize=10,ToggleElementMorph.prototype.inactiveColor=new Color(180,180,180),ToggleElementMorph.prototype.init=function(t,e,i,o,h,n,r,s){this.target=t||null,this.action=e||null,this.element=i,this.query=o||function(){return!0},this.environment=h||null,this.hint=n||null,this.builder=r||"nop",this.captionString=s||null,this.labelAlignment="right",this.state=!1,TriggerMorph.uber.init.call(this),this.color=i.color,this.createLabel()},ToggleElementMorph.prototype.createBackgrounds=function(){var t=!MorphicPreferences.isFlat||this.is3D;this.color=this.element.color,this.element.removeShadow(),this.element[this.builder](),t&&this.element.addShadow(this.shadowOffset,this.shadowAlpha),this.silentSetExtent(this.element.fullBounds().extent()),this.pressImage=this.element.fullImage(),this.element.removeShadow(),this.element.setColor(this.inactiveColor),this.element[this.builder](this.contrast),t&&this.element.addShadow(this.shadowOffset,0),this.normalImage=this.element.fullImage(),this.element.removeShadow(),this.element.setColor(this.color.lighter(this.contrast)),this.element[this.builder](this.contrast),t&&this.element.addShadow(this.shadowOffset,this.shadowAlpha),this.highlightImage=this.element.fullImage(),this.element.removeShadow(),this.element.setColor(this.color),this.element[this.builder](),this.image=this.normalImage},ToggleElementMorph.prototype.setColor=function(t){this.element.setColor(t),this.createBackgrounds(),this.refresh()},ToggleElementMorph.prototype.createLabel=function(){var t;this.captionString&&(this.label=new StringMorph(this.captionString,this.fontSize,this.fontStyle,!0),this.add(this.label),t=this.top()+(this.height()-this.label.height())/2,"right"===this.labelAlignment?this.label.setPosition(new Point(this.right(),t)):this.label.setPosition(new Point(this.left()-this.label.width(),t)))},ToggleElementMorph.prototype.trigger=ToggleButtonMorph.prototype.trigger,ToggleElementMorph.prototype.refresh=ToggleButtonMorph.prototype.refresh,ToggleElementMorph.prototype.mouseEnter=ToggleButtonMorph.prototype.mouseEnter,ToggleElementMorph.prototype.mouseLeave=ToggleButtonMorph.prototype.mouseLeave,ToggleElementMorph.prototype.mouseDownLeft=ToggleButtonMorph.prototype.mouseDownLeft,ToggleElementMorph.prototype.mouseClickLeft=ToggleButtonMorph.prototype.mouseClickLeft,DialogBoxMorph.prototype=new BoxMorph,DialogBoxMorph.prototype.constructor=DialogBoxMorph,DialogBoxMorph.uber=BoxMorph.prototype,DialogBoxMorph.prototype.fontSize=18,DialogBoxMorph.prototype.titleFontSize=20,DialogBoxMorph.prototype.fontStyle="Microsoft YaHei",DialogBoxMorph.prototype.color=PushButtonMorph.prototype.color,DialogBoxMorph.prototype.titleTextColor=new Color(255,255,255),DialogBoxMorph.prototype.titleBarColor=this.titleBarBoxColor,DialogBoxMorph.prototype.contrast=40,DialogBoxMorph.prototype.corner=2,DialogBoxMorph.prototype.padding=14,DialogBoxMorph.prototype.titlePadding=6,DialogBoxMorph.prototype.buttonContrast=50,DialogBoxMorph.prototype.buttonFontSize=12,DialogBoxMorph.prototype.buttonCorner=12,DialogBoxMorph.prototype.buttonEdge=6,DialogBoxMorph.prototype.buttonPadding=0,DialogBoxMorph.prototype.buttonOutline=3,DialogBoxMorph.prototype.buttonOutlineColor=PushButtonMorph.prototype.color,DialogBoxMorph.prototype.buttonOutlineGradient=!0,DialogBoxMorph.prototype.instances={},DialogBoxMorph.prototype.init=function(t,e,i){this.is3D=!1,this.target=t||null,this.action=e||null,this.environment=i||null,this.key=null,this.labelString=null,this.label=null,this.head=null,this.body=null,this.buttons=null,DialogBoxMorph.uber.init.call(this),this.isDraggable=!0,this.color=this.dialogboxColor,this.createLabel(),this.createButtons(),this.setExtent(new Point(300,150))},DialogBoxMorph.prototype.inform=function(t,e,i,o){var h=new TextMorph(e,this.fontSize,this.fontStyle,!0,!1,"center",null,null,MorphicPreferences.isFlat?null:new Point(1,1),new Color(255,255,255));this.key||(this.key="inform"+t+e),this.labelString=t,this.createLabel(),o&&this.setPicture(o),e&&this.addBody(h),this.addButton("ok","OK"),this.drawNew(),this.fixLayout(),this.popUp(i)},DialogBoxMorph.prototype.askYesNo=function(t,e,i,o){var h=new TextMorph(e,18,"Microsoft YaHei",!1,!1,"center",null,null,(MorphicPreferences.isFlat,null),new Color(0,0,0));this.key||(this.key="decide"+t+e),h.color=new Color(134,134,134),this.labelString=t,this.createLabel(),o&&this.setPicture(o),this.addBody(h),this.addButton("ok","Yes"),this.addButton("cancel","No"),this.body.setWidth(340-2*this.padding),this.body.setHeight(340-2*this.padding),this.fixLayout(),this.drawNew(),this.popUp(i)},DialogBoxMorph.prototype.askYesNoCancel=function(t,e,i,o){var h=new TextMorph(e,18,"Microsoft YaHei",!1,!1,"center",null,null,(MorphicPreferences.isFlat,null),new Color(0,0,0));this.key||(this.key="decide"+t+e),h.color=new Color(134,134,134),this.labelString=t,this.createLabel(),o&&this.setPicture(o),this.addBody(h),this.addButton("yes","Yes"),this.addButton("ok","No"),this.addButton("cancel","Cancel"),this.body.setWidth(440-2*this.padding),this.body.setHeight(440-2*this.padding),this.fixLayout(),this.setHeight(180),this.drawNew(),this.popUp(i)},DialogBoxMorph.prototype.prompt=function(t,e,i,o,h,n,r,s,l,a){var d,p,u=new InputFieldMorph(e,r||!1,h||null,h?n||!1:!1);u.setWidth(250),r?(o&&(p=new AlignmentMorph("column",this.padding),o.setPosition(p.position()),p.add(o)),isNil(s)||isNil(l)||(d=new SliderMorph(100*s,100*l,100*parseFloat(e),(l-s)/10*100,"horizontal"),d.alpha=1,d.color=this.color.lighter(50),d.setHeight(.7*u.height()),d.setWidth(u.width()),d.action=function(t){a&&a(t/100),u.setContents(t/100),u.edit()},p||(p=new AlignmentMorph("column",this.padding)),p.add(d)),p&&(p.fixLayout(),this.setPicture(p),p.fixLayout())):o&&this.setPicture(o),this.reactToChoice=function(t){d&&(d.value=100*t,d.drawNew(),d.changed()),a&&a(t)},u.reactToKeystroke=function(){var t=u.getValue();d&&(t=Math.max(t,s),d.value=100*t,d.drawNew(),d.changed()),a&&a(t)},this.labelString=t,this.createLabel(),this.key||(this.key="prompt"+t+e),this.addBody(u),u.drawNew(),this.addButton("ok","OK"),this.addButton("cancel","Cancel"),this.fixLayout(),this.drawNew(),this.fixLayout(),this.popUp(i)},DialogBoxMorph.prototype.promptCode=function(t,e,i,o,h){function n(t){return new TextMorph(localize(t),10,null,!1,null,null,null,null,MorphicPreferences.isFlat?null:new Point(1,1),new Color(255,255,255))}var r=new ScrollFrameMorph,s=new TextMorph(e||""),l=new AlignmentMorph("column",this.padding),a=o?Math.max(o.width,400):400;this.getInput=function(){return s.text},r.padding=6,r.setWidth(a),r.acceptsDrops=!1,r.contents.acceptsDrops=!1,s.fontName="monospace",s.fontStyle="monospace",s.fontSize=11,s.setPosition(r.topLeft().add(r.padding)),s.enableSelecting(),s.isEditable=!0,r.setHeight(a/4),r.fixLayout=nop,r.edge=InputFieldMorph.prototype.edge,r.fontSize=InputFieldMorph.prototype.fontSize,r.typeInPadding=InputFieldMorph.prototype.typeInPadding,r.contrast=InputFieldMorph.prototype.contrast,r.drawNew=InputFieldMorph.prototype.drawNew,r.drawRectBorder=InputFieldMorph.prototype.drawRectBorder,r.addContents(s),s.drawNew(),o&&this.setPicture(o),this.labelString=t,this.createLabel(),this.key||(this.key="promptCode"+t+e),l.setColor(this.color),l.add(r),h&&l.add(n(h)),l.fixLayout(),this.addBody(l),r.drawNew(),l.drawNew(),this.addButton("ok","OK"),this.addButton("cancel","Cancel"),this.fixLayout(),this.drawNew(),this.fixLayout(),this.popUp(i),s.edit()},DialogBoxMorph.prototype.promptVector=function(t,e,i,o,h,n,r,s){function l(t){return new TextMorph(localize(t),10,null,!1,null,null,null,null,MorphicPreferences.isFlat?null:new Point(1,1),new Color(255,255,255))}var a=new AlignmentMorph("row",4),d=new InputFieldMorph(e.x.toString(),!0),p=new InputFieldMorph(e.y.toString(),!0),u=new AlignmentMorph("column",2),g=new AlignmentMorph("column",2),c=new AlignmentMorph("column",2),w=new AlignmentMorph("column",this.padding);c.alignment="left",c.setColor(this.color),w.setColor(this.color),u.alignment="left",u.setColor(this.color),g.alignment="left",g.setColor(this.color),u.add(l(o)),u.add(d),g.add(l(h)),g.add(p),a.add(u),a.add(g),c.add(a),s&&w.add(l(s)),w.add(c),a.fixLayout(),u.fixLayout(),g.fixLayout(),c.fixLayout(),w.fixLayout(),this.labelString=t,this.createLabel(),r&&this.setPicture(r),this.addBody(w),a.drawNew(),u.drawNew(),d.drawNew(),g.drawNew(),p.drawNew(),w.fixLayout(),this.addButton("ok","OK"),i instanceof Point&&this.addButton(function(){d.setContents(i.x.toString()),p.setContents(i.y.toString())},"Default"),this.addButton("cancel","Cancel"),this.fixLayout(),this.drawNew(),this.fixLayout(),this.edit=function(){d.edit()},this.getInput=function(){return new Point(d.getValue(),p.getValue())},this.key||(this.key="vector"+t),this.popUp(n)},DialogBoxMorph.prototype.promptCredentials=function(t,e,i,o,h,n,r,s,l,a){function d(t){return new TextMorph(localize(t),10,null,!1,null,null,null,null,MorphicPreferences.isFlat?null:new Point(1,1),new Color(255,255,255))}function p(t,e){var i=new PushButtonMorph(N,function(){window.open(e)},"  "+localize(t)+"  ");return i.fontSize=10,i.corner=N.buttonCorner,i.edge=N.buttonEdge,i.outline=N.buttonOutline,i.outlineColor=N.buttonOutlineColor,i.outlineGradient=N.buttonOutlineGradient,i.padding=N.buttonPadding,i.contrast=N.buttonContrast,i.drawNew(),i.fixLayout(),i}function u(){var t,e,i=(new Date).getFullYear()+(new Date).getMonth()/12,o=+w.getValue()||0,h=c.getValue();return h instanceof Array&&(h=h[0]),isNaN(o)&&(o=0),t=["January","February","March","April","May","June","July","August","September","October","November","December"].indexOf(h),isNaN(t)&&(t=0),e=o+t/12,i-e}function g(){function t(t,e){var i=new SpeechBubbleMorph(localize(e));i.isPointingRight=!1,i.drawNew(),i.popUp(s,t.leftCenter().subtract(new Point(i.width()+2,0))),t.edit&&t.edit()}var i,o,h=m.getValue();if("login"===e?i=[M,b]:"signup"===e?i=[M,c,w,m]:"changePassword"===e?i=[C,b,S]:"resetPassword"===e&&(i=[M]),o=detect(i,function(t){return!t.getValue()}))return t(o,"please fill out\nthis field"),!1;if("signup"===e){if(M.getValue().length<4)return t(M,"User name must be four\ncharacters or longer"),!1;if(h.indexOf(" ")>-1||-1===h.indexOf("@")||-1===h.indexOf("."))return t(m,"please provide a valid\nemail address"),!1}if("changePassword"===e){if(b.getValue().length<6)return t(b,"password must be six\ncharacters or longer"),!1;if(b.getValue()!==S.getValue())return t(S,"passwords do\nnot match"),!1}return"signup"!==e||x?!0:(t(y,"please agree to\nthe TOS"),!1)}var c,w,f,y,M=new InputFieldMorph,m=new InputFieldMorph,b=new InputFieldMorph,S=new InputFieldMorph,C=new InputFieldMorph,x=!1,B=new AlignmentMorph("row",4),P=new AlignmentMorph("column",2),T=new AlignmentMorph("column",2),k=new AlignmentMorph("column",2),v=new AlignmentMorph("row",4),L=new AlignmentMorph("column",this.padding),I={},D=(new Date).getFullYear(),F=D-20,N=this;for(c=new InputFieldMorph(null,!1,{January:["January"],February:["February"],March:["March"],April:["April"],May:["May"],June:["June"],July:["July"],August:["August"],September:["September"],October:["October"],November:["November"],December:["December"]},!0),D;D>F;D-=1)I[D.toString()+" "]=D;I[F+" "+localize("or before")]="< "+D,w=new InputFieldMorph(null,!1,I,!0),k.alignment="left",k.setColor(this.color),L.setColor(this.color),P.alignment="left",P.setColor(this.color),T.alignment="left",T.setColor(this.color),M.setWidth(200),c.setWidth(100),w.contents().minWidth=80,w.setWidth(80),m.setWidth(200),b.setWidth(200),S.setWidth(200),C.setWidth(200),b.contents().text.toggleIsPassword(),S.contents().text.toggleIsPassword(),C.contents().text.toggleIsPassword(),"login"===e&&(k.add(d("User name:")),k.add(M)),"signup"===e&&(k.add(d("User name:")),k.add(M),P.add(d("Birth date:")),P.add(c),T.add(d("year:")),T.add(w),B.add(P),B.add(T),k.add(B),f=d("foo"),k.add(f),k.add(m)),"login"===e&&(k.add(d("Password:")),k.add(b)),"changePassword"===e&&(k.add(d("Old password:")),k.add(C),k.add(d("New password:")),k.add(b),k.add(d("Repeat new password:")),k.add(S)),"resetPassword"===e&&(k.add(d("User name:")),k.add(M)),a&&L.add(d(a)),L.add(k),(i||h)&&L.add(v),i&&v.add(p(o,i)),h&&v.add(p(n,h)),r&&(y=new ToggleMorph("checkbox",this,function(){x=!x},r,function(){return x}),y.edge=this.buttonEdge/2,y.outline=this.buttonOutline/2,y.outlineColor=this.buttonOutlineColor,y.outlineGradient=this.buttonOutlineGradient,y.contrast=this.buttonContrast,y.drawNew(),y.fixLayout(),L.add(y)),B.fixLayout(),P.fixLayout(),T.fixLayout(),k.fixLayout(),v.fixLayout(),L.fixLayout(),this.labelString=t,this.createLabel(),l&&this.setPicture(l),this.addBody(L),M.drawNew(),B.drawNew(),P.drawNew(),c.drawNew(),T.drawNew(),w.drawNew(),b.drawNew(),S.drawNew(),C.drawNew(),m.drawNew(),L.fixLayout(),this.addButton("ok","OK"),this.addButton("cancel","Cancel"),this.fixLayout(),this.drawNew(),this.fixLayout(),this.accept=function(){g()&&DialogBoxMorph.prototype.accept.call(N)},this.edit=function(){"changePassword"===e?C.edit():M.edit()},this.getInput=function(){return{username:M.getValue(),email:m.getValue(),oldpassword:C.getValue(),password:b.getValue(),choice:x}},this.reactToChoice=function(){"signup"===e&&(f.changed(),f.text=u()<=13?"E-mail address of parent or guardian:":"E-mail address:",f.text=localize(f.text),f.drawNew(),f.changed())},this.reactToChoice(),this.key||(this.key="credentials"+t+e),this.popUp(s)},DialogBoxMorph.prototype.accept=function(){this.action&&("function"==typeof this.target?"function"==typeof this.action?this.target.call(this.environment,this.action.call()):this.target.call(this.environment,this.action):"function"==typeof this.action?this.action.call(this.target,this.getInput()):this.target[this.action](this.getInput())),this.destroy()},DialogBoxMorph.prototype.withKey=function(t){return this.key=t,this},DialogBoxMorph.prototype.popUp=function(t){t&&(this.key&&(this.instances[t.stamp]?(this.instances[t.stamp][this.key]&&this.instances[t.stamp][this.key].destroy(),
this.instances[t.stamp][this.key]=this):(this.instances[t.stamp]={},this.instances[t.stamp][this.key]=this)),t.add(this),t.keyboardReceiver=this,this.setCenter(t.center()),this.edit())},DialogBoxMorph.prototype.destroy=function(){DialogBoxMorph.uber.destroy.call(this),this.key&&delete this.instances[this.key]},DialogBoxMorph.prototype.ok=function(){this.accept()},DialogBoxMorph.prototype.yes=function(){this.action&&("function"==typeof this.target?"function"==typeof this.action?this.target.call(this.environment,this.action.call()):this.target.call(this.environment,this.action):"function"==typeof this.action?this.action.call(this.target,!0):this.target[this.action](!0)),this.destroy()},DialogBoxMorph.prototype.cancel=function(){this.destroy()},DialogBoxMorph.prototype.edit=function(){this.children.forEach(function(t){return t.edit?t.edit():void 0})},DialogBoxMorph.prototype.getInput=function(){return this.body instanceof InputFieldMorph?this.body.getValue():null},DialogBoxMorph.prototype.justDropped=function(t){t.world.keyboardReceiver=this,this.edit()},DialogBoxMorph.prototype.destroy=function(){var t=this.world();t.keyboardReceiver=null,t.hand.destroyTemporaries(),DialogBoxMorph.uber.destroy.call(this)},DialogBoxMorph.prototype.normalizeSpaces=function(t){var e,i,o="",h=!1;for(e=0;e<t.length;e+=1)i=t[e]," "===i?h&&(o+=i,h=!1):(o+=i,h=!0);return o.trim()},DialogBoxMorph.prototype.createLabel=function(){this.label&&this.label.destroy(),this.labelString&&(this.label=new StringMorph(localize(this.labelString),20,"微软雅黑",!0,!1,!1,null,this.titleBarBoxColor.darker(this.contrast)),this.label.color=this.titleTextColor,this.label.drawNew(),this.add(this.label))},DialogBoxMorph.prototype.createButtons=function(){this.buttons&&this.buttons.destroy(),this.buttons=new AlignmentMorph("row",this.padding),this.add(this.buttons)},DialogBoxMorph.prototype.addButton=function(t,e){var i=new PushButtonMorph(this,t||"ok","  "+localize(e||"OK")+"  ",null);return i.fontSize=16,i.fontStyle="微软雅黑",i.corner=2,i.outline=this.buttonOutline,i.outlineColor=this.buttonOutlineColor,i.color=this.normalButtonColor,i.labelColor=new Color(255,255,255),i.outlineGradient=this.buttonOutlineGradient,i.padding=this.buttonPadding,i.labelMinExtent=new Point(75,30),i.contrast=this.buttonContrast,i.drawNew(),i.fixLayout(),this.buttons.add(i),i},DialogBoxMorph.prototype.setPicture=function(t){var e;t instanceof Morph?e=t:(e=new Morph,e.image=t,e.silentSetWidth(t.width),e.silentSetHeight(t.height)),this.addHead(e)},DialogBoxMorph.prototype.addHead=function(t){this.head&&this.head.destroy(),this.head=t,this.add(this.head)},DialogBoxMorph.prototype.addBody=function(t){this.body&&this.body.destroy(),this.body=t,this.add(this.body)},DialogBoxMorph.prototype.addShadow=function(){nop()},DialogBoxMorph.prototype.removeShadow=function(){nop()},DialogBoxMorph.prototype.fixLayout=function(){var t,e=fontHeight(this.titleFontSize)+2*this.titlePadding;this.head&&(this.head.setPosition(this.position().add(new Point(this.padding,e+this.padding))),this.silentSetWidth(this.head.width()+2*this.padding),this.silentSetHeight(this.head.height()+2*this.padding+e)),this.body&&(this.head?(this.body.setPosition(this.head.bottomLeft().add(new Point(0,this.padding))),this.silentSetWidth(Math.max(this.width(),this.body.width()+2*this.padding)),this.silentSetHeight(this.height()+this.body.height()+this.padding),t=this.width(),this.head.setLeft(this.left()+Math.round((t-this.head.width())/2)),this.body.setLeft(this.left()+Math.round((t-this.body.width())/2))):(this.body.setPosition(this.position().add(new Point(this.padding,e+this.padding))),this.silentSetWidth(this.body.width()+2*this.padding),this.silentSetHeight(this.body.height()+2*this.padding+e))),this.label&&(this.label.setCenter(this.center()),this.label.setTop(this.top()+(e-this.label.height())/2)),this.buttons&&this.buttons.children.length>0&&(this.buttons.fixLayout(),this.silentSetHeight(this.height()+this.buttons.height()+this.padding),this.buttons.setCenter(this.center()),this.buttons.setBottom(this.bottom()-this.padding))},DialogBoxMorph.prototype.shadowImage=function(t,e){var i,o,h,n,r,s=t||new Point(7,7),l=e||new Color(0,0,0);return i=this.extent(),o=this.image,h=newCanvas(i),r=h.getContext("2d"),r.drawImage(o,0,0),r.globalCompositeOperation="destination-out",r.drawImage(o,-s.x,-s.y),n=newCanvas(i),r=n.getContext("2d"),r.drawImage(h,0,0),r.globalCompositeOperation="source-atop",r.fillStyle=l.toString(),r.fillRect(0,0,i.x,i.y),n},DialogBoxMorph.prototype.shadowImageBlurred=function(t,e){var i,o,h,n,r=t||new Point(7,7),s=this.shadowBlur,l=e||new Color(0,0,0);return i=this.extent().add(2*s),o=this.image,h=newCanvas(i),n=h.getContext("2d"),n.shadowOffsetX=r.x,n.shadowOffsetY=r.y,n.shadowBlur=s,n.shadowColor=l.toString(),n.drawImage(o,s-r.x,s-r.y),n.shadowOffsetX=0,n.shadowOffsetY=0,n.shadowBlur=0,n.globalCompositeOperation="destination-out",n.drawImage(o,s-r.x,s-r.y),h},DialogBoxMorph.prototype.processKeyPress=function(){nop()},DialogBoxMorph.prototype.processKeyDown=function(t){switch(t.keyCode){case 13:this.ok();break;case 27:this.cancel();break;default:nop()}},DialogBoxMorph.prototype.drawNew=function(){this.fullChanged(),Morph.prototype.trackChanges=!1,DialogBoxMorph.uber.removeShadow.call(this),this.fixLayout();var t,e,i,o,h=this.width(),n=this.height(),r=Math.floor(fontHeight(this.titleFontSize)+2*this.titlePadding),s=this.corner/2,l=MorphicPreferences.isFlat&&!this.is3D;return this.image=newCanvas(this.extent()),t=this.image.getContext("2d"),l?t.fillStyle=this.titleBarBoxColor.toString():t.fillStyle=this.color.toString(),t.beginPath(),this.outlinePathTitle(t,l?0:this.corner),t.closePath(),t.fill(),t.fillStyle=this.titleBarBoxColor.toString(),t.fillRect(0,7,this.width(),Math.ceil(fontHeight(this.titleFontSize))),t.fillStyle=this.color.toString(),t.beginPath(),this.outlinePathBody(t,l?0:this.corner),t.closePath(),t.fill(),l?(e=t.createLinearGradient(0,n-this.corner,0,n),e.addColorStop(0,this.color.toString()),e.addColorStop(1,this.color.darker(this.contrast.toString())),t.lineWidth=this.corner,t.lineCap="round",t.strokeStyle=e,t.beginPath(),t.moveTo(this.corner,n-s),t.lineTo(this.corner+1,n-s),t.stroke(),e=t.createLinearGradient(0,n-this.corner,0,n),e.addColorStop(0,this.color.toString()),e.addColorStop(1,this.color.darker(this.contrast.toString())),t.lineWidth=this.corner,t.lineCap="butt",t.strokeStyle=e,t.beginPath(),t.moveTo(this.corner,n-s),t.lineTo(h-this.corner,n-s),t.stroke(),e=t.createLinearGradient(h-this.corner,0,h,0),e.addColorStop(0,this.color.toString()),e.addColorStop(1,this.color.darker(this.contrast).toString()),t.lineWidth=this.corner,t.lineCap="butt",t.strokeStyle=e,t.beginPath(),t.moveTo(h-s,r),t.lineTo(h-s,n-this.corner),t.stroke(),i=h-this.corner,o=n-this.corner,e=t.createRadialGradient(i,o,0,i,o,this.corner),e.addColorStop(0,this.color.toString()),e.addColorStop(1,this.color.darker(this.contrast.toString())),t.lineCap="butt",t.strokeStyle=e,t.beginPath(),t.arc(i,o,s,radians(90),radians(0),!0),t.stroke(),e=t.createLinearGradient(0,0,this.corner,0),e.addColorStop(1,this.color.toString()),e.addColorStop(0,this.color.lighter(this.contrast).toString()),t.lineCap="butt",t.strokeStyle=e,t.beginPath(),t.moveTo(s,r),t.lineTo(s,n-2*this.corner),t.stroke(),e=t.createLinearGradient(0,0,this.corner,0),e.addColorStop(1,this.color.toString()),e.addColorStop(0,this.color.lighter(this.contrast).toString()),t.lineCap="round",t.strokeStyle=e,t.beginPath(),t.moveTo(s,n-2*this.corner),t.lineTo(s,n-this.corner-s),t.stroke(),DialogBoxMorph.uber.addShadow.call(this),Morph.prototype.trackChanges=!0,void this.fullChanged()):(DialogBoxMorph.uber.addShadow.call(this,new Point(0,0)),Morph.prototype.trackChanges=!0,void this.fullChanged())},DialogBoxMorph.prototype.outlinePathTitle=function(t,e){var i=this.width(),o=Math.ceil(fontHeight(this.titleFontSize))+2*this.titlePadding;t.arc(e,e,e,radians(-180),radians(-90),!1),t.arc(i-e,e,e,radians(-90),radians(-0),!1),t.lineTo(i,o),t.lineTo(0,o)},DialogBoxMorph.prototype.outlinePathBody=function(t,e){var i=this.width(),o=this.height(),h=Math.floor(fontHeight(this.titleFontSize))+2*this.titlePadding;t.moveTo(0,h),t.lineTo(i,h),t.arc(i-e,o-e,e,radians(0),radians(90),!1),t.arc(e,o-e,e,radians(90),radians(180),!1)},AlignmentMorph.prototype=new Morph,AlignmentMorph.prototype.constructor=AlignmentMorph,AlignmentMorph.uber=Morph.prototype,AlignmentMorph.prototype.init=function(t,e){this.orientation=t||"row",this.alignment="center",this.padding=e||0,this.respectHiddens=!1,AlignmentMorph.uber.init.call(this)},AlignmentMorph.prototype.drawNew=function(){this.image=newCanvas(new Point(1,1)),this.fixLayout()},AlignmentMorph.prototype.fixLayout=function(){var t,e=this,i=null;return 0===this.children.length?null:(this.children.forEach(function(o){var h,n=o.fullBounds();(o.isVisible||e.respectHiddens)&&(i?(h=i.fullBounds(),"row"===e.orientation?o.setPosition(h.topRight().add(new Point(e.padding,(h.height()-n.height())/2))):o.setPosition(h.bottomLeft().add(new Point("center"===e.alignment?(h.width()-n.width())/2:0,e.padding))),t=t.merge(n)):t=n,i=o)}),void(this.bounds=t))},InputFieldMorph.prototype=new BoxMorph,InputFieldMorph.prototype.constructor=InputFieldMorph,InputFieldMorph.uber=Morph.prototype,InputFieldMorph.prototype.corner=5,InputFieldMorph.prototype.edge=0,InputFieldMorph.prototype.fontSize=12,InputFieldMorph.prototype.typeInPadding=2,InputFieldMorph.prototype.contrast=90,InputFieldMorph.prototype.init=function(t,e,i,o,h,n){var r=new StringFieldMorph(t||"",null,n,null,null,null,null,h),s=new ArrowMorph("down",0,Math.max(Math.floor(this.fontSize/6),1));this.choices=i||null,this.isReadOnly=o||!1,this.isNumeric=e||!1,this.isFixable=h||!1,this.fontSize=n||this.fontSize,r.alpha=0,r.fontSize=16,r.drawNew(),this.oldContentsExtent=r.extent(),this.isNumeric=e||!1,InputFieldMorph.uber.init.call(this),this.color=new Color(228,228,228),this.add(r),this.add(s),r.isDraggable=!1,this.drawNew()},InputFieldMorph.prototype.contents=function(){return detect(this.children,function(t){return t instanceof StringFieldMorph})},InputFieldMorph.prototype.arrow=function(){return detect(this.children,function(t){return t instanceof ArrowMorph})},InputFieldMorph.prototype.setChoice=function(t){this.setContents(t),this.escalateEvent("reactToChoice",t)},InputFieldMorph.prototype.setContents=function(t){var e=this.contents();return e.text.text=t,void 0===t?null:(null===t?e.text.text="":t.toString&&(e.text.text=t.toString()),e.drawNew(),void e.changed())},InputFieldMorph.prototype.edit=function(){var t=this.contents();t.text.edit(),t.text.selectAll()},InputFieldMorph.prototype.setIsNumeric=function(t){var e;this.isNumeric=t,this.contents().isNumeric=t,this.contents().text.isNumeric=t,e=this.getValue(),this.isNumeric&&(e=parseFloat(e),isNaN(e)&&(e=null)),this.setContents(e)},InputFieldMorph.prototype.dropDownMenu=function(){var t,e=this.choices,i=new MenuMorph(this.setChoice,null,this,this.fontSize);if(e instanceof Function?e=e.call(this):isString(e)&&(e=this[e]()),!e)return null;if(i.addItem(" ",null),e instanceof Array)e.forEach(function(t){i.addItem(t[0],t[1])});else for(t in e)Object.prototype.hasOwnProperty.call(e,t)&&("~"===t[0]?i.addLine():i.addItem(t,e[t]));return i.items.length>0?void i.popUpAtHand(this.world()):null},InputFieldMorph.prototype.fixLayout=function(){var t=this.contents(),e=this.arrow();return t?(t.isNumeric=this.isNumeric,t.isEditable=!this.isReadOnly,this.choices?(e.setSize(this.fontSize),e.show()):(e.setSize(0),e.hide()),this.silentSetHeight(t.height()+2*this.edge+2*this.typeInPadding),this.isFixable?this.silentSetWidth(Math.max(t.minWidth+2*this.edge+2*this.typeInPadding,t.width()+2*this.typeInPadding)):(this.silentSetWidth(Math.max(t.minWidth+2*this.edge+2*this.typeInPadding,this.width())),t.setWidth(this.width()-this.edge-this.typeInPadding-(this.choices?e.width()+this.typeInPadding:0))),t.silentSetPosition(new Point(this.edge,this.edge).add(this.typeInPadding).add(this.position())),void e.silentSetPosition(new Point(this.right()-e.width()-this.edge,t.top()))):null},InputFieldMorph.prototype.mouseClickLeft=function(t){this.arrow().bounds.containsPoint(t)?this.dropDownMenu():this.isReadOnly?this.dropDownMenu():this.escalateEvent("mouseClickLeft",t)},InputFieldMorph.prototype.getValue=function(){var t,e=this.contents();return this.isNumeric&&(t=parseFloat(e.text),!isNaN(t))?t:this.normalizeSpaces(e.string())},InputFieldMorph.prototype.normalizeSpaces=DialogBoxMorph.prototype.normalizeSpaces,InputFieldMorph.prototype.drawNew=function(){var t,e;this.fixLayout(),this.image=newCanvas(this.extent()),t=this.image.getContext("2d"),this.parent?(this.parent.color.eq(new Color(215,215,215))?this.color=this.color:this.color=this.color,e=this.color):e=new Color(120,120,120),e=this.color,t.fillStyle=this.color.toString(),this.cachedClr=e.toString(),this.cachedClrBright=e.lighter(this.contrast).toString(),this.cachedClrDark=e.darker(this.contrast).toString(),this.outlinePath instanceof Function?(this.outlinePath(t,Math.max(this.corner-this.border,0),this.border),t.closePath(),t.fill()):t.fillRect(this.edge,this.edge,this.width()-2*this.edge,this.height()-2*this.edge),this.drawRectBorder(t)},InputFieldMorph.prototype.drawRectBorder=function(t){var e,i=.5*this.edge;(!MorphicPreferences.isFlat||this.is3D)&&(t.lineWidth=this.edge,t.lineJoin="round",t.lineCap="round",t.shadowOffsetY=i,t.shadowBlur=4*this.edge,t.shadowColor=this.cachedClrDark,e=t.createLinearGradient(0,0,0,this.edge),e.addColorStop(0,this.cachedClr),e.addColorStop(1,this.cachedClrDark),t.strokeStyle=e,t.beginPath(),t.moveTo(this.edge,i),t.lineTo(this.width()-this.edge-i,i),t.stroke(),t.shadowOffsetY=0,e=t.createLinearGradient(0,0,this.edge,0),e.addColorStop(0,this.cachedClr),e.addColorStop(1,this.cachedClrDark),t.strokeStyle=e,t.beginPath(),t.moveTo(i,this.edge),t.lineTo(i,this.height()-this.edge-i),t.stroke(),t.shadowOffsetX=0,t.shadowOffsetY=0,t.shadowBlur=0,e=t.createLinearGradient(0,this.height()-this.edge,0,this.height()),e.addColorStop(0,this.cachedClrBright),e.addColorStop(1,this.cachedClr),t.strokeStyle=e,t.beginPath(),t.moveTo(this.edge,this.height()-i),t.lineTo(this.width()-this.edge,this.height()-i),t.stroke(),e=t.createLinearGradient(this.width()-this.edge,0,this.width(),0),e.addColorStop(0,this.cachedClrBright),e.addColorStop(1,this.cachedClr),t.strokeStyle=e,t.beginPath(),t.moveTo(this.width()-i,this.edge),t.lineTo(this.width()-i,this.height()-this.edge),t.stroke())};