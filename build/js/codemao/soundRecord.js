var soundRecord=function(e){function o(){try{this.count>1?alert("浏览器不支持录音哦~"):++this.count,c=e.world,d=c.children[0],navigator.getUserMedia||(navigator.getUserMedia=navigator.mozGetUserMedia||navigator.webkitGetUserMedia||navigator.msGetUserMedia),navigator.mediaDevices&&navigator.mediaDevices.getUserMedia?(console.log("Not deal with navigator.mediaDevices.getUserMedia yet."),s=navigator.mediaDevices.getUserMedia({video:!1,audio:!0}).then(function(e){t(e)}),s["catch"](function(e){console.log(e),alert("没有找到录音设备哦~")})):navigator.getUserMedia?navigator.getUserMedia({video:!1,audio:!0},t,function(e){console.log(e),alert("没有找到录音设备哦~")}):(console.log("浏览器不支持录音(Your browser did not support getUserMedia for record."),alert("浏览器不支持录音哦~"))}catch(o){console.log(o)}}function t(o){var t=e.AudioContext||e.webkitAudioContext,r=new t,n=r.createMediaStreamSource(o);console.log("Media stream created."),i=new Recorder(n),console.log("Recorder initialised."),i&&(editorVM.needInitRecorder=!1)}function r(){i&&i.record()}function n(){i&&i.stop(),console.log("Recording Completed"),a(),i&&i.clear()}function a(){console.log(i),i&&i.exportWAV(function(e){try{var o=document.createElement("record-sound");console.log("audio prepared");var t=new FileReader;t.onloadend=function(){var e=new CDNUpload;e.getToken(t.result,function(e){o.src=e.src},{src:t.result})},t.readAsDataURL(e);var r=URL.createObjectURL(e);o.controls=!1,o.src=r;var n,a="录音1";do{n=!1;for(var i=0;i<d.currentSprite.sounds.contents.length;++i)if(d.currentSprite.sounds.contents[i].name==a){a="录音"+(i+2),n=!0;break}}while(n);d.droppedAudio(o,a)}catch(c){console.log(c)}})}try{var i,c,d,s,l=0;return{count:l,init:o,startUserMedia:t,startRecording:r,stopRecording:n,createAudio:a}}catch(g){console.log(g)}}(window);