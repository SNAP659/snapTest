"use strict";var configMap={tab1:1,tab2:2},editorVM=new Vue({el:"#costume-editor",data:{curTab:!0,showEditor:!1,nameOfTab1:"造型",needInitRecorder:!0,isRecording:!1,rotationStyle:1},methods:{toggleTab:function(e){e===configMap.tab1?(this.curTab=!0,CostumeEditor.refresh()):(this.curTab=!1,SoundEditor.refresh())},closeEditor:function(e){this.showEditor=!1,null!=IDEMorph.paintEditor&&IDEMorph.paintEditor.destroy()},toggleRotationStyle:function(e){IDEMorph&&(this.rotationStyle=e,IDEMorph.currentSprite.rotationStyle=e,IDEMorph.currentSprite.changed(),IDEMorph.currentSprite.drawNew(),IDEMorph.currentSprite.changed())},addNewCostume:function(){var e=world.children[0];e.isUploadCostume=!0,this.showEditor=!1,e.paintEditor&&e.paintEditor.destroy(),materialVM.displayMaterialWindow=!0},openPalette:function(){var e=world.children[0];e?e.paintNewCostume():console.log("Can't find IDE.")},addNewSound:function(){world.children[0];this.showEditor=!1,materialVM.displayMaterialWindow=!0},recordSound:function(){this.isRecording=!0,soundRecord.startRecording()},initRecording:function(){soundRecord?soundRecord.init():alert("噢！好像浏览器不支持录音哦？")},stopRecording:function(){soundRecord.stopRecording(),this.isRecording=!1}}}),placeholderObj;!function(){var e=document.querySelector(".costume-list .wrapper");placeholderObj=document.createElement("div"),placeholderObj.style.cssText="width: 100%; height: 4rem; border-radius: 0.5rem; margin-bottom: 1rem; background-color: rgba(76, 174, 79, 0.419608);",placeholderObj.addEventListener("dragover",function(e){0!==e.dataTransfer.types.length&&e.preventDefault()}),placeholderObj.addEventListener("drop",function(t){t.preventDefault();var r=document.querySelector('.item[costume="'+t.dataTransfer.getData("text")+'"]');e.insertBefore(r,placeholderObj)})}();var CostumeEditor={};CostumeEditor.build=function(e){},CostumeEditor.show=function(){editorVM.curTab=!0,editorVM.showEditor=!0,this.refresh()},CostumeEditor.hide=function(){editorVM.showEditor=!1,IDEMorph.paintEditor&&world.height()>590&&world.width()>1330&&IDEMorph.paintEditor.destroy()},CostumeEditor.refresh=function(e){var t=IDEMorph,r=t.currentSprite;t.currentSprite instanceof StageMorph?editorVM.nameOfTab1="背景":editorVM.nameOfTab1="造型",e=e||r.costumes.contents;var o=document.querySelector(".costume-list .wrapper");o.innerHTML="","背景"==editorVM.nameOfTab1?o.setAttribute("style","top:150px"):o.setAttribute("style","top:150px"),e.forEach(function(i,n){var d=document.createElement("div");d.classList.add("item"),d.setAttribute("draggable","true"),d.addEventListener("dragstart",function(e){e.dataTransfer.setData("text",d.getAttribute("costume"))}),d.addEventListener("dragend",function(){o.removeChild(placeholderObj);var t=Array.prototype.slice.call(o.children);r.costumes.contents=t.map(function(t,r,o){return e[t.getAttribute("costume")]})}),d.addEventListener("dragover",function(e){0!==e.dataTransfer.types.length&&(e.preventDefault(),o.insertBefore(placeholderObj,d.nextElementSibling))}),d.addEventListener("dragleave",function(){}),d.addEventListener("drop",function(e){e.preventDefault();var t=document.querySelector('.item[costume="'+e.dataTransfer.getData("text")+'"]');o.insertBefore(t,d.nextElementSibling)}),r.costume==i&&d.classList.add("selected"),d.innerHTML='<div class="costume-icon"></div><input class="costume-name"/><div class="costume-btns"><div class="copy-costume"><i class="fa fa-copy"></i></div><div class="modify-costume"><i class="fa fa-pencil-square-o"></i></div><div class="delete-costume"><i class="fa fa-times"></i></div></div>',d.setAttribute("costume",n),d.querySelector(".costume-icon").appendChild(i.contents),d.querySelector(".costume-name").setAttribute("value",i.name),d.querySelector(".costume-name").addEventListener("blur",function(){t.currentSprite.costume.name=this.value}),d.addEventListener("click",function(){var e=t.currentSprite.costumes.contents[this.attributes.costume.value];t.currentSprite.wearCostume(e);var r=document.querySelector(".costume-list .item.selected");r&&r.classList.remove("selected"),d.classList.add("selected")}),d.querySelector(".copy-costume").addEventListener("click",function(e){var r=e.currentTarget.parentNode.parentNode.attributes.costume.value,o=t.currentSprite.costumes.contents[r].copy();e.stopPropagation(),t.currentSprite.costumes.add(o,parseInt(r,10)+2),CostumeEditor.refresh()}),d.querySelector(".modify-costume").addEventListener("click",function(e){if(e.stopPropagation(),t.currentSprite.costume){var r=t.currentSprite.costumes.contents[e.currentTarget.parentNode.parentNode.attributes.costume.value];t.currentSprite.wearCostume(r),t.currentSprite.costume.edit(world,world.children[0],!1,null,CostumeEditor.refresh),world.height()>590&&world.width()>1330||(editorVM.showEditor=!1)}}),d.querySelector(".delete-costume").addEventListener("click",function(e){var r=e.currentTarget.parentNode.parentNode,o=parseInt(r.attributes.costume.value);t.currentSprite.costume===t.currentSprite.costumes.contents[o]?(t.currentSprite.costumes.remove(o+1),t.currentSprite.wearCostume(t.currentSprite.costumes.contents[0])):t.currentSprite.costumes.remove(o+1),CostumeEditor.refresh()}),o.appendChild(d)})};var soundEditorAudio=document.createElement("audio");soundEditorAudio.style.display="none",document.body.appendChild(soundEditorAudio);var SoundEditor={soundEditorAudio:soundEditorAudio,wrapper:document.querySelector(".sound-list .wrapper"),needBuild:!0,build:function(){this.needBuild&&(this.needBuild=!1,this.soundEditorAudio.addEventListener("pause",function(){SoundEditor.wrapper.querySelector(".fa-pause").parentNode.innerHTML='<i class="fa fa-play-circle-o"></i>'}))},show:function(){editorVM.curTab=!1,editorVM.showEditor=!0,this.refresh()},hide:function(){editorVM.curTab=!0},refresh:function(e){var t=world.children[0],r=t.currentSprite;e=e||r.sounds.contents,this.wrapper.innerHTML="",this.wrapper.setAttribute("style","top:150px"),e.forEach(function(e,r){var o=document.createElement("div");o.classList.add("item"),o.innerHTML='<div class="sound-icon"><i class="fa fa-music"></i></div><div class="sound-name">'+e.name+'</div><div class="sound-btns"><div class="play-sound"><i class="fa fa-play-circle-o"></i></div><div class="delete-sound"><i class="fa fa-times"></i></div></div>',o.setAttribute("sound",r),o.addEventListener("click",function(){var e=document.querySelector(".sound-list .item.selected");e&&e.classList.remove("selected"),o.classList.add("selected")}),o.querySelector(".play-sound").addEventListener("click",function(e){var r=e.currentTarget.parentNode.parentNode,o=SoundEditor.wrapper.querySelector(".fa-pause");if(o)SoundEditor.soundEditorAudio.pause();else{var i=t.currentSprite.sounds.contents[r.getAttribute("sound")];SoundEditor.soundEditorAudio.src=i.audio.src,SoundEditor.soundEditorAudio.play(),r.querySelector(".sound-btns .play-sound").innerHTML='<i class="fa fa-pause"></i>'}}),o.querySelector(".delete-sound").addEventListener("click",function(e){var r=e.currentTarget.parentNode.parentNode,o=parseInt(r.getAttribute("sound"));t.currentSprite.sounds.remove(o+1),SoundEditor.soundEditorAudio.pause(),SoundEditor.refresh()}),SoundEditor.wrapper.appendChild(o)})}};