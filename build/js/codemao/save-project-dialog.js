!function(){function e(){return c=new Vue({el:"#save-project-dialog-container",data:{id:null,selectedId:null,isShow:!1,projectList:[],projectName:"",thumbnail:null,selectedThumbnail:null},methods:{hide:function(){r.hide()},show:function(){r.show()},refresh:function(){i()},save:function(e){t(e,r.param)},saveLocal:function(e){d.saveProjectToDisk(),window.codemao.socket.emit("buriedpoint",{type:"saveprojecttodisk"})},select:function(e){o(e)},judgeSelected:function(e){return e==this.selectedId?"current-item":void 0},"delete":function(e){confirmDialog.build("确认删除","确认要删除《"+e.workName+"》吗？",function(i){i&&a(e.id)},{isHideCancel:!0})}}})}function i(e){var i=r.object.querySelector("#current-project-thumbnail .project-thumbnail");d=world.children[0],r.thumbnail=d.stage.thumbnail(new Point(311,450)),c.id=d.id,c.selectedId=null,c.projectName=d.projectName,i.innerHTML="",i.appendChild(r.thumbnail),n(),e?r.param=e:r.param=null}function n(){$.ajax({type:"GET",url:window.codemao.apiServer+"/work/list?type=old",async:!0,dataType:"json",xhrFields:{withCredentials:!0},success:function(e){e?c.projectList=e.data.workList:console.log("读取项目列表失败")}})}function t(e,i){var n={};d.savingCheckCount=0,c.projectName?(i&&(n=i),n.id=e,detect(c.projectList,function(e){return e.workName===c.projectName?(n.id=e.id,!0):void 0})||(n.id=null),n.name=c.projectName,n.id?confirmDialog.build("覆盖作品","确定要覆盖《"+n.name+"》吗？",function(e){e&&(savingMessage.saving(d.checkUploading,d,n),c.hide())},{isHideCancel:!0}):(savingMessage.saving(d.checkUploading,d,n),c.hide())):confirmDialog.build("提示","先给作品起个名字吧?",null,{isHideCancel:!0,isHideNo:!0})}function o(e){c.projectName=e.workName,c.selectedId=e.id}function a(e){$.ajax({url:codemao.apiServer+"/work/"+e,type:"DELETE",async:!0,dataType:"text",xhrFields:{withCredentials:!0},success:function(){c.refresh()}})}var c,d,r={};window.SaveProjectDialog=r,r.object=document.getElementById("save-project-dialog"),r.param={},r.build=function(){r.vm||(r.vm=e())},r.refresh=i,r.show=function(e){i(e),c.isShow=!0},r.hide=function(){c.isShow=!1}}();